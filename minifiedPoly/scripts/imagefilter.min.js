function ind(n,i){return(i*d*cWidth+n)*d*4}function changePixels3(n,i){displayImage=!0,displayTriangulation=!1,displayPoints=!1,edgePoints=[],n||(n="smooth");for(var r=JSON.parse(JSON.stringify(i)),e=0;e<=cWidth;e+=1)for(var o=0;o<=cHeight;o+=1){var t=[ind(e-1,o-1),ind(e,o-1),ind(e+1,o-1),ind(e-1,o),ind(e,o),ind(e+1,o),ind(e-1,o+1),ind(e,o+1),ind(e+1,o+1)],d=smoothAvg3(e,o,i,n);r[t[4]]=d[0],r[t[4]+1]=d[1],r[t[4]+2]=d[2]}return r}function smoothAvg3(n,i,r,e){var o=[ind(n-1,i-1),ind(n,i-1),ind(n+1,i-1),ind(n-1,i),ind(n,i),ind(n+1,i),ind(n-1,i+1),ind(n,i+1),ind(n+1,i+1)],t=[1,1,1,1,1,1,1,1,1];t=operator3[e].arr;var d=[0,0,0],a=1;if("blur"==operator3[e].type)for(var s=0;s<t.length;s++)a+=Math.abs(t[s]);for(var l=0;l<o.length;l++)d[0]+=r[o[l]]*t[l],d[1]+=r[o[l]+1]*t[l],d[2]+=r[o[l]+2]*t[l];return d[0]/=a,d[1]/=a,d[2]/=a,gray_value=.2126*d[0]+.7152*d[1]+.0722*d[2],"edge"==e&&gray_value>=5&&edgePoints.push([n,i,gray_value]),d}function changePixels5(n){n||(n="smooth");for(var i=JSON.parse(JSON.stringify(pixels)),r=0;r<=cWidth;r+=1)for(var e=0;e<=cHeight;e+=1){var o=[ind(r-2,e-2),ind(r-1,e-2),ind(r,e-2),ind(r+1,e-2),ind(r+2,e-2),ind(r-2,e-1),ind(r-1,e-1),ind(r,e-1),ind(r+1,e-1),ind(r+2,e-1),ind(r-2,e),ind(r-1,e),ind(r,e),ind(r+1,e),ind(r+2,e),ind(r-2,e+1),ind(r-1,e+1),ind(r,e+1),ind(r+1,e+1),ind(r+2,e+1),ind(r-2,e+2),ind(r-1,e+2),ind(r,e+2),ind(r+1,e+2),ind(r+2,e+2)],t=smoothAvg3(r,e,pixels,n);i[o[12]]=t[0],i[o[12]+1]=t[1],i[o[12]+2]=t[2]}copyTo(i,pixels),updatePixels()}function smoothAvg5(n,i,r,e){var o=[ind(k-2,j-2),ind(k-1,j-2),ind(k,j-2),ind(k+1,j-2),ind(k+2,j-2),ind(k-2,j-1),ind(k-1,j-1),ind(k,j-1),ind(k+1,j-1),ind(k+2,j-1),ind(k-2,j),ind(k-1,j),ind(k,j),ind(k+1,j),ind(k+2,j),ind(k-2,j+1),ind(k-1,j+1),ind(k,j+1),ind(k+1,j+1),ind(k+2,j+1),ind(k-2,j+2),ind(k-1,j+2),ind(k,j+2),ind(k+1,j+2),ind(k+2,j+2)],t=[1,1,1,1,1,1,1,1,1];t=operator5[e].arr;var d=[0,0,0],a=1;"blur"==operator5[e].type&&(a=operator5[e].sum);for(var s=0;s<o.length;s++)d[0]+=r[o[s]]*t[s],d[1]+=r[o[s]+1]*t[s],d[2]+=r[o[s]+2]*t[s];return d[0]/=a,d[1]/=a,d[2]/=a,d}function copyTo(n,i,r){if(r)for(var e=0;e<i.length;e++)i.push(n[e]);else for(e=0;e<i.length;e++)i[e]=n[e]}function ind1(n,i){return(i*d*cWidth+n)*d}function edgeGradientAngle(n,i,r){var e=smoothAvg3(n,i,r,"sobelX")[0],o=smoothAvg3(n,i,r,"sobelY")[0];return[e*e+o*o,roundAngle(atan(o/e))]}function roundAngle(n){var i=3*Math.PI/8,r=Math.PI/8,e=-Math.PI/8,o=-3*Math.PI/8;return n>i||n<o?0:n>r?1:n<e?3:2}function generateEGA(n){filter(GRAY),loadPixels();for(var i=[],r=millis(),e=0;e<cWidth;e++)for(var o=0;o<cHeight;o++)i.push(edgeGradientAngle(o,e,n));return console.log("Time: "+(millis()-r)),i}function supress(n,i,r){var e=ind1(n,i),o=neighborhoodIndices(n,i,1),t=[],d=r[e][0],a=r[e][1];console.log(o);for(var s=0;s<o.length;s++)r[o[s]][1]==a&&t.push(r[o[s]]);console.log(t);for(var l=0;l<t.length;l++)console.log(t[0]),d<t[l][0]&&console.log("Not Local Max!",d);console.log(t,"Local Max!",r[e])}function neighborhoodIndices(n,i,r){for(var e=[],o=-r;o<=r;o++)for(var t=-r;t<=r;t++)e.push(ind1(t+i,o+n));return e}function reduceDensity(n){for(var i=256;i>=n;i--)for(var r=edgePoints.filter(function(n){if(n[2]==i)return!0}),e=0;e<r.length;e++){for(var o=hashCoordinate(r[e][0],r[e][1]),t=findIndexFromHash(o),d=verticesHashTable[t],a=0;a<d.length;a++)r[e][0]!=d[a][0]&&squaredist(r[e][0],r[e][1],d[a][0],d[a][1])<=100&&(verticesHashTable[t][a][0]=-10);for(var s=0;s<verticesHashTable[t].length;)-10==verticesHashTable[t][s][0]?verticesHashTable[t].splice(s,1):s++}}function basicReduceDensity(){for(var n=256;n>=0;n--)edgePoints.filter(function(i){if(i[2]==n)return!0})}var edgePointsHashTable,edgePoints=[],colorThreshold=40,operator3={smooth:{arr:[1,1,1,1,1,1,1,1,1],type:"blur"},edge:{arr:[0,1,0,1,-4,1,0,1,0],type:"filter"},edgeLR:{arr:[0,-1,0,0,2,0,0,-1,0],type:"filter"},edgeUD:{arr:[0,0,0,-1,2,-1,0,0,0],type:"filter"},sharpen:{arr:[0,-1,0,-1,5,-1,0,-1,0],type:"filter"},gaussian:{arr:[1,2,1,2,4,2,1,2,1],type:"blur"},sobelX:{arr:[1,2,1,0,0,0,-1,-2,-1],type:"filter"},sobelY:{arr:[1,0,-1,2,0,-2,1,0,-1],type:"filter"},gx:{arr:[-1,-1,-1,0,0,0,1,1,1],type:"filter"},gy:{arr:[-1,0,1,-1,0,1,-1,0,1],type:"filter"}},operator5={smooth:{arr:[1,1,1,1,1,1,1,1,1],type:"blur",sum:25},gaussian:{arr:[1,4,7,4,1,4,16,26,16,4,7,26,41,26,7,4,16,26,16,4,1,4,7,4,1],type:"blur",sum:273}};