function preload(){img1=loadImage("images/white.jpg")}function setup(){d=pixelDensity(),loadPixels();var e=img1.height/620;for(cWidth=round(img1.width/e),cHeight=round(img1.height/e),myCanvas=createCanvas(cWidth,cHeight),triangleCanvasLayer=createGraphics(cWidth,cHeight),generateHashSpace(),updateHashSpace(0,0,!0),updateHashSpace(cWidth,0,!0),updateHashSpace(0,cHeight,!0),updateHashSpace(cWidth,cHeight,!0),t=0;t<cWidth/80;t++){var i=80*t+round(random(0,30)),a=80*t+round(random(0,30));inCanvas(i,cHeight)&&updateHashSpace(i,cHeight,!0),inCanvas(a,0)&&updateHashSpace(a,0,!0)}for(var t=0;t<cHeight/80;t++){i=80*t+round(random(0,30)),a=80*t+round(random(0,30));inCanvas(cWidth,i)&&updateHashSpace(cWidth,i,!0),inCanvas(0,a)&&updateHashSpace(0,a,!0)}loadPixels(),frameRate(60);for(var s=0;s<max_undo;s++)storedVertices.push([]);recordVertices(),verticesHashTableFlat=verticesHashTable.reduce(function(e,i){return e.concat(i)}),$("#gamedisplay").css("right",(cWidth/2).toString()+"px"),myCanvas.parent("gamedisplay"),angleMode(DEGREES),$("#downloadSVG").on("click",function(){!1===finishedColoring?alert("Please wait until the coloring is finished before enlargining the work and downloading it"):triangulations[triangulations.length-1].length>0?!0===display_mode_on?alert("At the moment, you can't download SVGs of the different display modes. Turn display mode off in settings to download SVG of the triangulation"):downloadSVG(cWidth,cHeight):alert("Make some poly art first")}),console.log("Finished Setting Up!"),$("#loadingText").css("top","30%"),$("#loadingText").css("opacity","0"),$("#loadingScreen").css("opacity","0"),window.setTimeout(function(){$("#loadingScreen").css("display","none"),$("#loadingText").html('Patience, we are making art <img src="images/loadingSymbol.gif" style="margin-left: 10px" width="32px" height="auto">')},1500),$("#brushSize")[0].value=brushSize,$("#brushDensity")[0].value=pointDensity+1,$("#defaultCanvas0").on("mouseenter",function(){active_canvas=!0}),$("#defaultCanvas0").on("mouseleave",function(){active_canvas=!1})}function colorIn(){for(image(img1,0,0,cWidth,cHeight),loadPixels(),sTime=millis(),stepD1=0;stepD1<triangulations[0].length-1;stepD1+=3){var e=[0,0,0];e=averageColor(triangulatedVerticesFlat[triangulations[triangulations.length-1][stepD1]][0],triangulatedVerticesFlat[triangulations[triangulations.length-1][stepD1]][1],triangulatedVerticesFlat[triangulations[triangulations.length-1][stepD1+1]][0],triangulatedVerticesFlat[triangulations[triangulations.length-1][stepD1+1]][1],triangulatedVerticesFlat[triangulations[triangulations.length-1][stepD1+2]][0],triangulatedVerticesFlat[triangulations[triangulations.length-1][stepD1+2]][1],colorAccuracy),tColors.push(e[0],e[1],e[2])}finishedColoring=!0,fTime=millis(),console.log("Coloring took:"+((fTime-sTime)/1e3).toFixed(3)+" secs")}function draw(){if(totalpoints=0,background("#FFFFFF"),!0===displayImage&&image(img1,0,0,cWidth,cHeight),!0===flowerEffect)!0===flowering&&(delaunayDisplay(triangulations[0],triangleCanvasLayer,triangulatedVerticesFlat,!0,flower_step,flowering_speed),(flower_step+=flowering_speed)+1>triangulations[0].length/3&&(flowering=!1,fTime=millis(),console.log("Coloring took:"+((fTime-sTime)/1e3).toFixed(3)+" secs"),flower_step=0));else if(!1===finishedColoring)for(colorIn(),finishedColoring=!0,j=0;j<triangulations.length;j++)delaunayDisplay(triangulations[j],triangleCanvasLayer);if(stroke(2),colorOfSquares.length>0&&!0===squares)for(noStroke(),i=0;i<colorOfSquares.length;i++){var e=colorOfSquares[i];fill(e[0],e[1],e[2]),rect(e[3],e[4],20,20)}for(fill(256,256,256),!0===displayTriangulation&&!0===finishedColoring&&(!0===flowerEffect&&!0===noColors?image(uncoloredTriangleCanvasLayer,0,0):image(triangleCanvasLayer,0,0)),fill(256,256,256),stroke(0,0,0),j=0;j<verticesHashTable.length;j++)for(k=0;k<verticesHashTable[j].length;k++)!0===displayPoints&&ellipse(verticesHashTable[j][k][0],verticesHashTable[j][k][1],5,5),totalpoints++;if(!0===display_grid){for(strokeWeight(1),stroke(150),j=0;j<cWidth/snappingAccuracy;j++)line(j*snappingAccuracy,0,j*snappingAccuracy,cHeight);for(j=0;j<cHeight/snappingAccuracy;j++)line(0,j*snappingAccuracy,cWidth,j*snappingAccuracy)}$("#numberPoints").text(totalpoints+" points"),$("#numberTriangles").text(parseInt(triangulations[triangulations.length-1].length/3)+" triangles"),!0===finishedColoring&&$("#lastTiming").text(((fTime-sTime)/1e3).toFixed(3)+" seconds");var a=oldX-mouseX,t=oldY-mouseY;if(accDist=sqrt(a*a+t*t),2===mode&&active_canvas)if(noFill(),stroke(2),stroke(200,200,200),ellipse(mouseX,mouseY,2*brushSize,2*brushSize),accDist>=critDist&&mouseIsPressed)if(mouseX>cWidth-1||mouseX<1||mouseY>cHeight-1||mouseY<1);else{accDist=0,critDist=random(15,20),oldX=mouseX,oldY=mouseY;var s=round(mouseX),n=round(mouseY);for(!0===snapping&&(s-=s%snappingAccuracy,n-=n%snappingAccuracy),unique_vertex(s,n)&&updateHashSpace(s,n,!0),i=0;i<pointDensity;i++){var o=random(-brushSize,brushSize),r=sqrt(brushSize*brushSize-o*o),l=random(-r,r);if(mouseX+o>cWidth-1||mouseX+o<1||mouseY+l>cHeight-1||mouseY+l<1);else{s=round(mouseX+o),n=round(mouseY+l);!0===snapping&&(s-=s%snappingAccuracy,n-=n%snappingAccuracy),unique_vertex(s,n)&&updateHashSpace(s,n,!0)}}}else mouseIsPressed||(critDist=0);3===mode&&!0===active_canvas&&(noFill(),stroke(2),stroke(200,200,200),ellipse(mouseX,mouseY,2*brushSize,2*brushSize),mouseIsPressed&&erase_vertices(mouseX,mouseY,brushSize)),!0===filteringView&&(pixels=filteredPixels,updatePixels())}function generate_normal_poly(e){noLoop(),$("#loadingScreen").css("display","block"),$("#loadingScreen").css("opacity","1"),window.setTimeout(function(){$("#loadingText").css("top","50%"),$("#loadingText").css("opacity","1")},0),filteredPixels.length>0?copyTo(filteredPixels,pixels):(image(img1,0,0,cWidth,cHeight),filter(GRAY),loadPixels()),!0===flowerEffect&&(flower_step=0,flowering=!0);var i=new Worker("scripts/webworkerArtGen.min.js");if(0==completedFilters)i.postMessage([[e[0],e[1]],pixels,e[2],e[3],e[4]]),i.onmessage=function(e){var i=e.data;generateHashSpace();for(var a=0;a<i[0].length;a++)updateHashSpace(i[0][a][0],i[0][a][1],!0);for(a=0;a<i[1].length;a++)detected_edge_vertices.push([i[1][a][0],i[1][a][1],i[1][a][2]]);for(var t=0;t<detected_edge_vertices.length;t++)detected_edge_vertices[t][2]>=colorThreshold&&updateHashSpace(detected_edge_vertices[t][0],detected_edge_vertices[t][1],!0);for(copyTo(i[2],pixels),km=0;km<pixels.length;km++)filteredPixels.push(pixels[km]);splitSquare(20),generateRandomSquares(20,.4),triangulate_and_display(),completedFilters=!0,window.setTimeout(function(){$("#loadingScreen").css("opacity","0"),$("#loadingText").css("opacity","0"),$("#loadingText").css("top","30%"),window.setTimeout(function(){$("#loadingScreen").css("display","none")},1800)},0),loop(),recordVertices()};else{for(generateHashSpace(),updateHashSpace(0,0,!0),updateHashSpace(cWidth,0,!0),updateHashSpace(0,cHeight,!0),updateHashSpace(cWidth,cHeight,!0),s=0;s<cWidth/80;s++){var a=80*s+Math.round(random(0,30)),t=80*s+Math.round(random(0,30));inCanvas(a,cHeight)&&updateHashSpace(a,cHeight,!0),inCanvas(t,0)&&updateHashSpace(t,0,!0)}for(var s=0;s<cHeight/80;s++){a=80*s+Math.round(random(0,30)),t=80*s+Math.round(random(0,30));inCanvas(cWidth,a)&&updateHashSpace(cWidth,a,!0),inCanvas(0,t)&&updateHashSpace(0,t,!0)}generateRandomSquares(20,.4);for(s=0;s<detected_edge_vertices.length;s++)detected_edge_vertices[s][2]>=colorThreshold&&updateHashSpace(detected_edge_vertices[s][0],detected_edge_vertices[s][1],!0);triangulate_and_display(),completedFilters=!0,$("#loadingScreen").css("opacity","0"),$("#loadingText").css("opacity","0"),$("#loadingText").css("top","30%"),window.setTimeout(function(){$("#loadingScreen").css("display","none")},1500),loop(),recordVertices()}}var myCanvas,img1,d,triangleCanvasLayer,uncoloredTriangleCanvasLayer,triangulations=[0],tColors=[],mode=1,colorOfSquares=[],displayTriangulation=!0,displayPoints=!0,displayImage=!0,display_grid=!1,noColors=!1,flowing=!0,brushSize=100,finishedColoring=!0,quickColor=!1,sTime=0,fTime=0,squares=!1,colorAccuracy=1,verticesHashTable=[],verticesHashTableFlat=[],totalpoints=0,triangulatedVerticesFlat=[],pointDensity=4,flowerEffect=!1,filteringView=!1,displayEdgePoints=!1,snapping=!1,snappingAccuracy=20,displayMode=0,artstyle=0,storedVertices=[],max_undo=50,cWidth=400,cHeight=400,active_canvas=!1,accDist=0,oldX=0,oldY=0,critDist=10,stepD=0,flowering=!1,flower_step=0,flowering_speed=1,filteredPixels=[],detected_edge_vertices=[];