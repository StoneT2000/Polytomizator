function preload(){img1=loadImage("images/white.jpg")}function setup(){d=pixelDensity(),loadPixels();var e=img1.height/620;for(cWidth=round(img1.width/e),cHeight=round(img1.height/e),myCanvas=createCanvas(cWidth,cHeight),triangleCanvasLayer=createGraphics(cWidth,cHeight),allVertices.push([0,0]),allVertices.push([cWidth,0]),allVertices.push([0,cHeight]),allVertices.push([cWidth,cHeight]),s=0;s<cWidth/80;s++){var i=80*s+round(random(0,30)),t=80*s+round(random(0,30));inCanvas(i,cHeight)&&allVertices.push([i,cHeight]),inCanvas(t,0)&&allVertices.push([t,0])}for(var s=0;s<cHeight/80;s++){var a=80*s+round(random(0,30)),n=80*s+round(random(0,30));inCanvas(cWidth,a)&&allVertices.push([cWidth,a]),inCanvas(0,n)&&allVertices.push([0,n])}loadPixels(),generateHashSpace(),frameRate(60);for(var l=0;l<max_undo;l++)storedVertices.push([]);recordVertices(),verticesHashTableFlat=verticesHashTable.reduce(function(e,i){return e.concat(i)}),$("#gamedisplay").css("right",(cWidth/2).toString()+"px"),myCanvas.parent("gamedisplay"),angleMode(DEGREES),$("#downloadSVG").on("click",function(){!1===finishedColoring?alert("Please wait until the coloring is finished before enlargining the work and downloading it"):triangulations[triangulations.length-1].length>0?downloadSVG(cWidth,cHeight):alert("Make some poly art first")}),console.log("Finished Setting Up!"),$("#loadingText").css("top","30%"),$("#loadingText").css("opacity","0"),$("#loadingScreen").css("opacity","0"),window.setTimeout(function(){$("#loadingScreen").css("display","none"),$("#loadingText").html('Patience, we are making art <img src="images/loadingSymbol.gif" style="margin-left: 10px" width="32px" height="auto">')},1500),$("#brushSize")[0].value=brushSize,$("#brushDensity")[0].value=pointDensity+1,$("#defaultCanvas0").on("mouseenter",function(){active_canvas=!0}),$("#defaultCanvas0").on("mouseleave",function(){active_canvas=!1})}function colorIn(){for(image(img1,0,0,cWidth,cHeight),loadPixels(),sTime=millis(),stepD1=0;stepD1<triangulations[0].length-1;stepD1+=3){var e=[0,0,0];e=averageColor(verticesHashTableFlat[triangulations[triangulations.length-1][stepD1]][0],verticesHashTableFlat[triangulations[triangulations.length-1][stepD1]][1],verticesHashTableFlat[triangulations[triangulations.length-1][stepD1+1]][0],verticesHashTableFlat[triangulations[triangulations.length-1][stepD1+1]][1],verticesHashTableFlat[triangulations[triangulations.length-1][stepD1+2]][0],verticesHashTableFlat[triangulations[triangulations.length-1][stepD1+2]][1],colorAccuracy),tColors.push(e[0],e[1],e[2])}finishedColoring=!0,fTime=millis(),console.log("Coloring took:"+((fTime-sTime)/1e3).toFixed(3)+" secs")}function draw(){if(0===fc&&(fs=millis()),background("#FFFFFF"),!0===displayImage&&image(img1,0,0,cWidth,cHeight),!0===flowerEffect){for(iterStep=ceil(triangulations[triangulations.length-1].length/fr/flowerEffectTime),iter=0;iter<iterStep;iter++)if(0===iter&&(image(img1,0,0,cWidth,cHeight),loadPixels()),!0===stepDelaunate&&triangulations.length>0&&!1===finishedColoring)if(triangulations[triangulations.length-1].length>0&&stepD<=triangulations[triangulations.length-1].length-1){0===stepD&&(sTime=millis());var e=[0,0,0];e=averageColor(triangulatedVerticesFlat[triangulations[triangulations.length-1][stepD]][0],triangulatedVerticesFlat[triangulations[triangulations.length-1][stepD]][1],triangulatedVerticesFlat[triangulations[triangulations.length-1][stepD+1]][0],triangulatedVerticesFlat[triangulations[triangulations.length-1][stepD+1]][1],triangulatedVerticesFlat[triangulations[triangulations.length-1][stepD+2]][0],triangulatedVerticesFlat[triangulations[triangulations.length-1][stepD+2]][1],colorAccuracy),tColors.push(e[0],e[1],e[2]),stepD+=3}else for(finishedColoring=!0,fTime=millis(),console.log("Coloring took:"+((fTime-sTime)/1e3).toFixed(3)+" secs"),j=0;j<triangulations.length;j++)delaunayDisplay(triangulations[j],triangleCanvasLayer)}else if(!1===finishedColoring)for(colorIn(),finishedColoring=!0,j=0;j<triangulations.length;j++)delaunayDisplay(triangulations[j],triangleCanvasLayer);if(stroke(2),colorOfSquares.length>0&&!0===squares)for(noStroke(),i=0;i<colorOfSquares.length;i++){var t=colorOfSquares[i];fill(t[0],t[1],t[2]),rect(t[3],t[4],20,20)}if(fill(256,256,256),!0===displayTriangulation&&!0===finishedColoring&&image(triangleCanvasLayer,0,0),!0===flowerEffect&&!0!==finishedColoring&&!0===displayTriangulation)for(j=0;j<triangulations.length;j++)delaunayDisplay_flower_effect(triangulations[j]);if(fill(256,256,256),stroke(0,0,0),!0===displayPoints){for(j=0;j<verticesHashTable.length;j++)for(k=0;k<verticesHashTable[j].length;k++)ellipse(verticesHashTable[j][k][0],verticesHashTable[j][k][1],5,5);for(j=0;j<edgePoints.length;j++)edgePoints[j][2]>colorThreshold&&!0===displayEdgePoints&&ellipse(edgePoints[j][0],edgePoints[j][1],5)}$("#numberPoints").text(allVertices.length+" points"),$("#numberTriangles").text(parseInt(triangulations[triangulations.length-1].length/3)+" triangles"),!0===finishedColoring&&$("#lastTiming").text(((fTime-sTime)/1e3).toFixed(3)+" seconds");var s=oldX-mouseX,a=oldY-mouseY;if(accDist=sqrt(s*s+a*a),2===mode)if(!1===downloading&&(noFill(),stroke(2),stroke(200,200,200),ellipse(mouseX,mouseY,2*brushSize,2*brushSize)),accDist>=critDist&&mouseIsPressed)if(mouseX>cWidth-1||mouseX<1||mouseY>cHeight-1||mouseY<1);else{accDist=0,critDist=random(15,20),oldX=mouseX,oldY=mouseY;var n=round(mouseX),l=round(mouseY);for(!0===snapping&&(n-=n%snappingAccuracy,l-=l%snappingAccuracy),unique_vertex(n,l)&&(allVertices.push([n,l]),updateHashSpace(n,l,!0)),i=0;i<pointDensity;i++){var o=random(-brushSize,brushSize),r=sqrt(brushSize*brushSize-o*o),c=random(-r,r);if(mouseX+o>cWidth-1||mouseX+o<1||mouseY+c>cHeight-1||mouseY+c<1);else{n=round(mouseX+o),l=round(mouseY+c);!0===snapping&&(n-=n%snappingAccuracy,l-=l%snappingAccuracy),unique_vertex(n,l)&&(allVertices.push([n,l]),updateHashSpace(n,l,!0))}}}else mouseIsPressed||(critDist=0);if(3===mode&&(!1===downloading&&(noFill(),stroke(2),stroke(200,200,200),ellipse(mouseX,mouseY,2*brushSize,2*brushSize)),mouseIsPressed)){var g=floor(mouseX/50),u=floor(mouseY/50),d=[];for(k=floor(-brushSize/50-2);k<ceil(brushSize/50+2);k++)for(j=floor(-brushSize/50-2);j<ceil(brushSize/50+2);j++)squaredist(g,u,g+k,u+j)<=brushSize/50*(brushSize/50)&&g+k>=0&&u+j>=0&&g+k<=ceil(cWidth/50)&&u+j<=ceil(cHeight/50)&&d.push(verticesHashTable[findIndexFromHash(100*(g+k)+u+j)]);if(d.length>0)for(k=0;k<d.length;k++)if(void 0!==d[k])for(p=0;p<d[k].length;p++){(s=d[k][p][0]-mouseX)*s+(a=d[k][p][1]-mouseY)*a<=brushSize*brushSize&&updateHashSpace(d[k][p][0],d[k][p][1],!1)}}5===++fc&&(ff=millis(),fr=ceil(4/((ff-fs)/1e3)),fc=0),!0===filteringView&&updatePixels()}function generate_normal_poly(e){noLoop(),$("#loadingScreen").css("display","block"),$("#loadingScreen").css("opacity","1"),window.setTimeout(function(){$("#loadingText").css("top","50%"),$("#loadingText").css("opacity","1")},0),filteredPixels.length>0?copyTo(filteredPixels,pixels):(image(img1,0,0,cWidth,cHeight),filter(GRAY),loadPixels());var t=new Worker("scripts/webworkerArtGen.min.js");if(0==completedFilters)t.postMessage([[e[0],e[1]],pixels,e[2],e[3],e[4]]),t.onmessage=function(e){var i=e.data;for(allVertices=i[0],edgePoints=i[1],copyTo(i[2],pixels),km=0;km<pixels.length;km++)filteredPixels.push(pixels[km]);splitSquare(20),generateRandomSquares(20,.4),pushEdgePointsToAll(),triangulize(),finishedColoring=!1,tColors=[],css_buttons.displayPoints(!1),displayPoints=!1,completedFilters=!0,window.setTimeout(function(){$("#loadingScreen").css("opacity","0"),$("#loadingText").css("opacity","0"),$("#loadingText").css("top","30%"),window.setTimeout(function(){$("#loadingScreen").css("display","none")},1800)},0),loop()};else{for((allVertices=[]).push([0,0]),allVertices.push([cWidth,0]),allVertices.push([0,cHeight]),allVertices.push([cWidth,cHeight]),i=0;i<cWidth/80;i++){var s=80*i+Math.round(Math.random(0,30)),a=80*i+Math.round(Math.random(0,30));inCanvas(s,cHeight)&&allVertices.push([s,cHeight]),inCanvas(a,cHeight)&&allVertices.push([a,0])}for(i=0;i<cHeight/80;i++){s=80*i+Math.round(Math.random(0,30)),a=80*i+Math.round(Math.random(0,30));inCanvas(cWidth,s)&&allVertices.push([cWidth,s]),inCanvas(0,a)&&allVertices.push([0,a])}generateRandomSquares(20,.4),pushEdgePointsToAll(),triangulize(),finishedColoring=!1,generateHashSpace(),tColors=[],css_buttons.displayPoints(!1),displayPoints=!1,completedFilters=!0,$("#loadingScreen").css("opacity","0"),$("#loadingText").css("opacity","0"),$("#loadingText").css("top","30%"),window.setTimeout(function(){$("#loadingScreen").css("display","none")},1500),loop()}}var myCanvas,img1,d,triangleCanvasLayer,allVertices=[],triangulations=[0],tColors=[],mode=1,colorOfSquares=[],displayTriangulation=!0,displayPoints=!0,displayImage=!0,stepDelaunate=!0,noColors=!1,flowing=!0,brushSize=100,downloading=!1,finishedColoring=!0,quickColor=!1,sTime=0,fTime=0,squares=!1,colorAccuracy=1,verticesHashTable=[],verticesHashTableFlat=[],triangulatedVerticesFlat=[],pointDensity=4,flowerEffect=!1,filteringView=!1,displayEdgePoints=!1,snapping=!1,snappingAccuracy=20,displayMode=0,artstyle=0,storedVertices=[],max_undo=50,cWidth=400,cHeight=400,active_canvas=!1,accDist=0,oldX=0,oldY=0,critDist=10,stepD=0,iterStep=4,fs=0,ff=0,fr=0,fc=0,flowerEffectTime=10,filteredPixels=[];