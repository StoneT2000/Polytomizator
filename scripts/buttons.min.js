function display_options(e){e&&(!0===e?($("#options_menu").css("z-index","100"),$("#options_menu").css("opacity","1")):(window.setTimeout(function(){$("#options_menu").css("z-index","-100")},200),$("#options_menu").css("opacity","0"),options_menu_open=!1)),!1===options_menu_open?($("#options_menu").css("z-index","100"),$("#options_menu").css("opacity","1"),$("#options_menu_gear > i").removeClass("fa-cog"),$("#options_menu_gear > i").addClass("fa-times"),$("#options_menu_gear").css("right","31px"),options_menu_open=!0):(window.setTimeout(function(){$("#options_menu").css("z-index","-100")},200),$("#options_menu").css("opacity","0"),options_menu_open=!1,$("#options_menu_gear > i").addClass("fa-cog"),$("#options_menu_gear > i").removeClass("fa-times"),$("#options_menu_gear").css("right","30px"))}function open_a_options(){$("#options_menu_additional").css("display","block")}function close_a_options(){$("#options_menu_additional").css("display","none")}function removeClassFromBrushes(e){$("#pointBrush").removeClass(e),$("#lineBrush").removeClass(e),$("#eraser").removeClass(e),$("#triangleMove").removeClass(e)}var completedFilters=!1,size_megapixels=22;$(document).ready(function(){var e=!1;document.addEventListener("keydown",function(e){e.metaKey&&e.shiftKey&&"KeyZ"===e.code&&redo(),e.metaKey&&0==e.shiftKey&&"KeyZ"===e.code&&undo()}),$("#undo").addClass("disabled"),$("#redo").addClass("disabled"),$("#undo").css("cursor","not-allowed"),$("#redo").css("cursor","not-allowed"),$("#pointBrush").addClass("active"),console.log("Polytomizator v57"),$("#grid_accuracy").val(20),$("#flower_effect_speed").val(1),$("#downloaded_poly_size").val(22),$(function(){$('[data-toggle="popover"]').popover()}),$(function(){$('[data-toggle="tooltip"]').tooltip()}),$("#displayColor").on("click",function(){if(!0===noColors?(noColors=!1,css_buttons.displayColor(!0)):(noColors=!0,css_buttons.displayColor(!1)),flowerEffect);else for(var e=0;e<triangulations.length;e++)delaunayDisplay(triangulations[e],triangleCanvasLayer)}),$("#displayPoints").on("click",function(){0==displayPoints?(displayPoints=!0,css_buttons.displayPoints(!0)):(displayPoints=!1,css_buttons.displayPoints(!1))}),$("#displayTriangulation").on("click",function(){0==displayTriangulation?(displayTriangulation=!0,css_buttons.displayTriangulation(!0)):(displayTriangulation=!1,css_buttons.displayTriangulation(!1))}),$("#displayImage").on("click",function(){0==displayImage?(displayImage=!0,css_buttons.displayImage(!0)):(displayImage=!1,css_buttons.displayImage(!1))}),$("#brushSize").on("focusout",function(){var e=parseInt(document.querySelector("#brushSize").value);!0===isNaN(e)||e<1?(alert("Type in a number larger than 0 for brush size"),$("#brushSize")[0].value=brushSize):brushSize=e}),$("#brushDensity").on("focusout",function(){var e=parseInt(document.querySelector("#brushDensity").value)-1;!0===isNaN(e)||e<1?(alert("Type in a number larger than 1 for brush density"),$("#brushDensity")[0].value=pointDensity+1):pointDensity=e}),$("#colorThreshold").on("focusout",function(){var e=parseInt(document.querySelector("#colorThreshold").value);!0===isNaN(e)||e<1?(alert("Type in a number larger than 1 for color threshold"),$("#colorThreshold")[0].value=colorThreshold):colorThreshold=e}),$("#pointBrush").on("click",function(){mode=1,removeClassFromBrushes("active"),$("#pointBrush").addClass("active")}),$("#lineBrush").on("click",function(){mode=2,removeClassFromBrushes("active"),$("#lineBrush").addClass("active")}),$("#eraser").on("click",function(){mode=3,removeClassFromBrushes("active"),$("#eraser").addClass("active")}),$("#triangleMover").on("click",function(){mode=4,removeClassFromBrushes("active"),$("#triangleMove").addClass("active")}),$("#file").on("change",function(){$("#label_file").text(this.files&&this.files.length?this.files[0].name.split(".")[0]:""),completedFilters=!1,img1=loadImage(window.URL.createObjectURL(document.getElementById("file").files[0]),function(){var e=img1.height/620;if(cWidth=round(img1.width/e),cHeight=round(img1.height/e),cWidth>.9*window.innerWidth){e=img1.width/(.9*window.innerWidth);cWidth=round(img1.width/e),cHeight=round(img1.height/e)}myCanvas=createCanvas(cWidth,cHeight),origcWidth=cWidth,origcHeight=cHeight,canvasScale=1,$("#gamedisplay").css("width",cWidth),$("#gamedisplay").css("margin-left",-cWidth/2),myCanvas.parent("gamedisplay"),triangulations=[0],tColors=[],verticesHashTable=[],triangulatedVerticesFlat=[],verticesHashTableFlat=[],d=pixelDensity(),storedVertices=[];for(var a=0;a<max_undo;a++)storedVertices.push([0,0]);for(generateHashSpace(),recordVertices(),updateHashSpace(0,0,!0),updateHashSpace(cWidth,0,!0),updateHashSpace(0,cHeight,!0),updateHashSpace(cWidth,cHeight,!0),n=0;n<cWidth/80;n++){var o=80*n+round(random(0,30)),i=80*n+round(random(0,30));inCanvas(o,cHeight)&&updateHashSpace(o,cHeight,!0),inCanvas(i,0)&&updateHashSpace(i,0,!0)}for(var n=0;n<cHeight/80;n++){o=80*n+round(random(0,30)),i=80*n+round(random(0,30));inCanvas(cWidth,o)&&updateHashSpace(cWidth,o,!0),inCanvas(0,i)&&updateHashSpace(0,i,!0)}finishedColoring=!0,image(img1,0,0,cWidth,cHeight),loadPixels(),filteredPixels=[],triangleCanvasLayer=createGraphics(cWidth,cHeight),verticesCanvasLayer=createGraphics(cWidth,cHeight),draw_all_points(verticesCanvasLayer,verticesHashTable),recordVertices()})}),$("#expandImage").on("click",function(){if(0==finishedColoring)alert("Please wait until the coloring is finished before downloading it");else{var e=2,a=cWidth*cHeight;e=sqrt(pow(2,20)*size_megapixels/a);expandImage(e,!0)}}),$("#polytomize").on("click",function(){triangulate_and_display()}),$("#saveThis").on("click",function(){saveData(),$("#saveThis").html("Saved<br>data!"),window.setTimeout(function(){$("#saveThis").html("Save this<br>canvas")},2e3)}),$("#loadThis").on("click",function(){loadData(JSON.parse(localStorage.getItem("art1"))),$("#loadThis").html("Loaded<br>Data!"),window.setTimeout(function(){$("#loadThis").html("Load last<br>canvas")},2e3)}),$("#options_menu_gear").on("click",function(){display_options()}),$("#displaygencubicpoly").on("click",function(){open_a_options(),display_options(!1),$("#options_menu_additional").html('<h4>Generate cubic poly art</h4><i id="close_a_options"class="fa fa-times"></i><span>Accuracy</span><input class="parameters form-control" type="text" placeholder="≥ 10" id="gencubicpoly_accuracy"><span>Density</span><input class="parameters form-control" type="text" placeholder="0 ~ 1" id="gencubicpoly_density"><button class="btn btn-outline-light" id="gencubicpoly">Generate</button>'),$("#gencubicpoly").on("click",function(){var e=parseFloat($("#gencubicpoly_density").val()),a=parseInt($("#gencubicpoly_accuracy").val());isNaN(e)||e<0||e>1?alert("Enter a decimal value between 0 and 1 for density"):isNaN(a)||a<=0?alert("Enter a integer larger than 0 for accuracy"):a==parseFloat($("#gencubicpoly_accuracy").val())?(generateCubicPoly(2*a,e),close_a_options()):alert("Enter a integer larger than 0 for accuracy")}),$("#close_a_options").on("click",function(){close_a_options()})}),$("#displaysnapvertices").on("click",function(){open_a_options(),display_options(!1),$("#options_menu_additional").html('<h4>Snap visible vertices to a grid</h4><i id="close_a_options"class="fa fa-times"></i><span>Accuracy</span><input class="parameters form-control" type="text" placeholder="≥ 10" id="snapping_accuracy"><button class="btn btn-outline-light" id="snap_vertices">Snap</button>'),$("#snap_vertices").on("click",function(){var e=parseInt($("#snapping_accuracy").val());isNaN(e)||e<=0?alert("Enter a integer larger than 0 for accuracy"):e==parseFloat($("#snapping_accuracy").val())?(snapVertices(e),close_a_options()):alert("Enter a integer larger than 0 for accuracy")}),$("#close_a_options").on("click",function(){close_a_options()})}),$("#displaygennormalpoly").on("click",function(){open_a_options(),display_options(!1),$("#options_menu_additional").html('<h4>Generate poly art</h4><i id="close_a_options"class="fa fa-times"></i><span>Color Threshold</span><input class="parameters form-control" type="text" placeholder="10 ~ 255" id="color_threshold"><button class="btn btn-outline-light" id="gennormalpoly">Generate</button>'),$("#gennormalpoly").on("click",function(){var e=parseFloat($("#color_threshold").val());if(isNaN(e)||e<10)alert("Enter a number larger than 10 for the color threshold");else{var a=cWidth*cHeight;if(a>3e6){var o=1.013*pow(10,-5)*a;if(!confirm("The canvas size is rather large and this process will take approximately "+o.toFixed(2)+" seconds"))return}colorThreshold=e,close_a_options(),generate_normal_poly([cWidth,cHeight,completedFilters,d,colorThreshold])}}),$("#close_a_options").on("click",function(){close_a_options()})}),$("#snapping").on("change",function(){$("#snapping")[0].checked?snapping=!0:snapping=!1}),$("#display_grid").on("change",function(){$("#display_grid")[0].checked?display_grid=!0:display_grid=!1}),$("#grid_accuracy").on("change",function(){var e=parseInt($("#grid_accuracy").val());if(isNaN(e)||e<2)return alert("Enter a integer more than 1 for grid accuracy"),void $("#grid_accuracy").val(snappingAccuracy);snappingAccuracy=e,$("#grid_accuracy").val(snappingAccuracy)}),$("#flower_effect").on("change",function(){$("#flower_effect")[0].checked?flowerEffect=!0:(flowerEffect=!1,flowering=!1)}),$("#flower_effect_speed").on("change",function(){var e=parseInt($("#flower_effect_speed").val());if(isNaN(e)||e<1)return alert("Enter a positive integer for flowering speed"),void $("#flower_effect_speed").val(flowering_speed);flowering_speed=e,$("#flower_effect_speed").val(e)});var a=2;$("#display_mode_selection").on("change",function(){var e=$("#display_mode_selection").val();"circles"==e?a=2:"rectangles"==e?a=1:"distorted_triangles"==e&&(a=3),!0===display_mode_on&&(displayMode=a,triangulate_and_display())}),$("#display_mode_check").on("change",function(){$("#display_mode_check")[0].checked?(displayMode=a,display_mode_on=!0,triangulate_and_display()):(displayMode=0,display_mode_on=!1,triangulate_and_display())}),$("#stats_mode_check").on("change",function(){$("#stats_mode_check")[0].checked?$("#stats_for_nerds").css("display","block"):$("#stats_for_nerds").css("display","none")}),$("#downloaded_poly_size").on("change",function(){var a=size_megapixels,o=parseFloat($("#downloaded_poly_size").val());if(0==e){confirm("Are you sure you want to change this value? If the image size is too high, the poly art may not download correctly. By default, it is set at 22MP")?(e=!0,!isNaN(o)&&o>=1?($("#downloaded_poly_size").val(o),size_megapixels=o):($("#downloaded_poly_size").val(a),alert("Please enter a positive number greater or equal to 1 for image size"))):$("#downloaded_poly_size").val(a)}else!isNaN(o)&&o>=1?($("#downloaded_poly_size").val(o),size_megapixels=o):($("#downloaded_poly_size").val(a),alert("Please enter a positive number greater or equal to 1 for image size"))})});var display_mode_on=!1,options_menu_open=!1;