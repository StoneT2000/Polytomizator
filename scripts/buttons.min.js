function display_options(o){o&&(!0===o?($("#options_menu").css("display","block"),window.setTimeout(function(){$("#options_menu").css("opacity","1")},1)):(window.setTimeout(function(){$("#options_menu").css("display","none")},200),$("#options_menu").css("opacity","0"),options_menu_open=!1)),!1===options_menu_open?($("#options_menu").css("display","block"),window.setTimeout(function(){$("#options_menu").css("opacity","1")},1),options_menu_open=!0):(window.setTimeout(function(){$("#options_menu").css("display","none")},200),$("#options_menu").css("opacity","0"),options_menu_open=!1)}function open_a_options(){$("#options_menu_additional").css("display","block")}function close_a_options(){$("#options_menu_additional").css("display","none")}var completedFilters=!1;$(document).on("ready",function(){document.addEventListener("keydown",function(o){o.metaKey&&o.shiftKey&&"KeyZ"===o.code&&redo(),o.metaKey&&0==o.shiftKey&&"KeyZ"===o.code&&undo()}),$("#pointBrush").css("background-color","RGB(140,140,140)"),console.log("Polytomizator v42"),$("#displayColor").on("click",function(){for(!0===noColors?(noColors=!1,css_buttons.displayColor(!0)):(noColors=!0,css_buttons.displayColor(!1)),j=0;j<triangulations.length;j++)delaunayDisplay(triangulations[j],triangleCanvasLayer)}),$("#displayPoints").on("click",function(){0==displayPoints?(displayPoints=!0,css_buttons.displayPoints(!0)):(displayPoints=!1,css_buttons.displayPoints(!1))}),$("#displayTriangulation").on("click",function(){0==displayTriangulation?(displayTriangulation=!0,css_buttons.displayTriangulation(!0)):(displayTriangulation=!1,css_buttons.displayTriangulation(!1))}),$("#displayImage").on("click",function(){0==displayImage?(displayImage=!0,css_buttons.displayImage(!0)):(displayImage=!1,css_buttons.displayImage(!1))}),$("#brushSize").on("focusout",function(){var o=parseInt(document.querySelector("#brushSize").value);!0===isNaN(o)||o<1?(alert("Type in a number larger than 0 for brush size"),$("#brushSize")[0].value=brushSize):brushSize=o}),$("#brushDensity").on("focusout",function(){var o=parseInt(document.querySelector("#brushDensity").value)-1;!0===isNaN(o)||o<1?(alert("Type in a number larger than 1 for brush density"),$("#brushDensity")[0].value=pointDensity+1):pointDensity=o}),$("#colorThreshold").on("focusout",function(){var o=parseInt(document.querySelector("#colorThreshold").value);!0===isNaN(o)||o<1?(alert("Type in a number larger than 1 for color threshold"),$("#colorThreshold")[0].value=colorThreshold):colorThreshold=o}),$("#durationOfFlowerEffect").on("focusout",function(){var o=parseInt(document.querySelector("#durationOfFlowerEffect").value);!0===isNaN(o)||o<1?alert("Type in a number larger than 1 for effect duration"):flowerEffectTime=o}),$("#flowerEffect").on("click",function(){!1===flowerEffect?(flowerEffect=!0,$("#flowerEffect").text("Instant Coloring: Off"),$("#durationOfFlowerEffect").css("z-index","0"),$("#flowerEffectTime").css("transform","translate(0,0)"),$("#durationOfFlowerEffect").css("transform","translate(0,0)")):(flowerEffect=!1,$("#flowerEffect").text("Instant Coloring: On"),$("#flowerEffectTime").css("transform","translate(0,-39px)"),$("#durationOfFlowerEffect").css("z-index","-5"),$("#durationOfFlowerEffect").css("transform","translate(0,-75px)"))}),$("#pointBrush").on("click",function(){mode=1,$("#pointBrush").css("background-color","RGB(140,140,140)"),$("#lineBrush").css("background-color",""),$("#eraser").css("background-color",""),$("#triangleMover").css("background-color","")}),$("#lineBrush").on("click",function(){mode=2,$("#lineBrush").css("background-color","RGB(140,140,140)"),$("#pointBrush").css("background-color",""),$("#eraser").css("background-color",""),$("#triangleMover").css("background-color","")}),$("#eraser").on("click",function(){mode=3,$("#eraser").css("background-color","RGB(140,140,140)"),$("#pointBrush").css("background-color",""),$("#lineBrush").css("background-color",""),$("#triangleMover").css("background-color","")}),$("#triangleMover").on("click",function(){mode=4,$("#triangleMover").css("background-color","RGB(140,140,140)"),$("#pointBrush").css("background-color",""),$("#lineBrush").css("background-color",""),$("#eraser").css("background-color","")}),$("#file").on("change",function(){completedFilters=!1,img1=loadImage(window.URL.createObjectURL(document.getElementById("file").files[0]),function(){var o=img1.height/620;if(cWidth=round(img1.width/o),cHeight=round(img1.height/o),cWidth>.9*window.innerWidth){o=img1.width/(.9*window.innerWidth);cWidth=round(img1.width/o),cHeight=round(img1.height/o)}for(cWidth%50==0&&cWidth++,cHeight%50==0&&cHeight++,myCanvas=createCanvas(cWidth,cHeight),$("#gamedisplay").css("right",(cWidth/2).toString()+"px"),myCanvas.parent("gamedisplay"),allVertices=[],triangulations=[0],tColors=[],verticesHashTable=[],verticesHashTableFlat=[],d=pixelDensity(),allVertices.push([0,0]),allVertices.push([cWidth,0]),allVertices.push([0,cHeight]),allVertices.push([cWidth,cHeight]),i=0;i<cWidth/80;i++){var e=80*i+round(random(0,30)),n=80*i+round(random(0,30));inCanvas(e,cHeight)&&allVertices.push([e,cHeight]),inCanvas(n,cHeight)&&allVertices.push([n,0])}for(i=0;i<cHeight/80;i++){e=80*i+round(random(0,30)),n=80*i+round(random(0,30));inCanvas(cWidth,e)&&allVertices.push([cWidth,e]),inCanvas(0,n)&&allVertices.push([0,n])}finishedColoring=!0,generateHashSpace(),image(img1,0,0,cWidth,cHeight),loadPixels(),filteredPixels=[],storedVertices=[];for(var t=0;t<max_undo;t++)storedVertices.push([]);triangleCanvasLayer=createGraphics(cWidth,cHeight),recordVertices()})}),$("#expandImage").on("click",function(){if(0==finishedColoring)alert("Please wait until the coloring is finished before enlargining the work and downloading it");else if(window.confirm("Are you sure you want to do this? You cannot go back and edit this work again.")){var o=2;o=cWidth>cHeight?ceil(6e3/cWidth):ceil(6e3/cHeight),expandImage(o,!0)}}),$("#polytomize").on("click",function(){triangulize(),finishedColoring=!1,image(img1,0,0,cWidth,cHeight),loadPixels(),tColors=[],sTime=millis(),css_buttons.displayPoints(!1),displayPoints=!1}),$("#saveThis").on("click",function(){saveData(),$("#saveThis").text("Saved data!"),window.setTimeout(function(){$("#saveThis").text("Save this canvas")},2e3)}),$("#loadThis").on("click",function(){loadData(JSON.parse(localStorage.getItem("art1"))),$("#loadThis").text("Loaded Data!"),window.setTimeout(function(){$("#loadThis").text("Load last saved")},2e3)}),$("#options_menu_gear").on("click",function(){display_options()}),$("#displaygencubicpoly").on("click",function(){open_a_options(),display_options(!1),$("#options_menu_additional").html('<h4>Generate cubic poly art</h4><i id="close_a_options"class="fa fa-times"></i><span>Accuracy</span><input class="parameters" type="text" placeholder="≥ 10" id="gencubicpoly_accuracy"><span>Density</span><input class="parameters" type="text" placeholder="0 ~ 1" id="gencubicpoly_density"><button id="gencubicpoly">Generate</button>'),$("#gencubicpoly").on("click",function(){var o=parseFloat($("#gencubicpoly_density").val()),e=parseInt($("#gencubicpoly_accuracy").val());isNaN(o)||o<0||o>1?alert("Enter a decimal value between 0 and 1 for density"):isNaN(e)||e<=0?alert("Enter a integer larger than 0 for accuracy"):e==parseFloat($("#gencubicpoly_accuracy").val())?(generateCubicPoly(2*e,o),close_a_options()):alert("Enter a integer larger than 0 for accuracy")}),$("#close_a_options").on("click",function(){close_a_options()})}),$("#displaysnapvertices").on("click",function(){open_a_options(),display_options(!1),$("#options_menu_additional").html('<h4>Snap visible vertices to a grid</h4><i id="close_a_options"class="fa fa-times"></i><span>Accuracy</span><input class="parameters" type="text" placeholder="≥ 10" id="snapping_accuracy"><button id="snap_vertices">Snap</button>'),$("#snap_vertices").on("click",function(){var o=parseInt($("#snapping_accuracy").val());isNaN(o)||o<=0?alert("Enter a integer larger than 0 for accuracy"):o==parseFloat($("#snapping_accuracy").val())?(snapVertices(2*o),close_a_options()):alert("Enter a integer larger than 0 for accuracy")}),$("#close_a_options").on("click",function(){close_a_options()})}),$("#displaygennormalpoly").on("click",function(){open_a_options(),display_options(!1),$("#options_menu_additional").html('<h4>Generate poly art</h4><i id="close_a_options"class="fa fa-times"></i><span>Color Threshold</span><input class="parameters" type="text" placeholder="10 ~ 255" id="color_threshold"><button id="gennormalpoly">Generate</button>'),$("#gennormalpoly").on("click",function(){var o=parseFloat($("#color_threshold").val());isNaN(o)||o<10?alert("Enter a number larger than 10 for the color threshold"):(colorThreshold=o,close_a_options(),generate_normal_poly([cWidth,cHeight,completedFilters,d,colorThreshold]))}),$("#close_a_options").on("click",function(){close_a_options()})}),$("#snapping").on("change",function(){$("#snapping")[0].checked&&(snapping=!0)})});var options_menu_open=!1;