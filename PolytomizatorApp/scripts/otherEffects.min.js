function generateCubicPoly(a,e,r){var i=.5;e&&(i=e),r||(verticesHashTable=[]),generateHashSpace(),updateHashSpace(0,0,!0),updateHashSpace(cWidth,0,!0),updateHashSpace(0,cHeight,!0),updateHashSpace(cWidth,cHeight,!0);for(var o=0;o<cWidth/a;o++)updateHashSpace(o*a,cHeight,!0),updateHashSpace(o*a,0,!0);for(o=0;o<cHeight/a;o++)updateHashSpace(cWidth,o*a,!0),updateHashSpace(0,o*a,!0);flowing=!1,!0===flowerEffect&&(flower_step=0,flowering=!0),image(img1,0,0,cWidth,cHeight),loadPixels(),splitSquare(a),scanSquareLR(a,1e8),image(img1,0,0,cWidth,cHeight),loadPixels(),scanSquareUD(a,1e8),generateRandomSquares(a,i),flowing=!0,triangulate_and_display(),recordVertices()}function splitSquare(a){colorOfSquares=[],image(img1,0,0,cWidth,cHeight),loadPixels();var e=cHeight/a,r=cWidth/a;for(ik=0;ik<e;ik++)for(jk=0;jk<r;jk++){var i=averageColorSquare(jk*a,ik*a,a,a,1);i.push(jk*a,ik*a),colorOfSquares.push(i)}}function averageColorSquare(a,e,r,o,n){a+o>cWidth&&(o=cWidth-a),e+r>cHeight&&(r=cHeight-e);var c=0,t=0,s=0,u=0;for(i=0;i<r;i+=n)for(j=0;j<o;j+=n){var d=fget(a+j,e+i);c+=d[0],t+=d[1],s+=d[2],u+=1}return[c/u,t/u,s/u]}function scanSquareLR(a,e,r){var i=800;for(r&&(i=r),k=0;k<colorOfSquares.length-1;k++){var o=colorOfSquares[k],n=colorOfSquares[k+1],c=o[0]-n[0],t=o[1]-n[1],s=o[2]-n[2];if(c*c+t*t+s*s>e||c*c>i||t*t>i||s*s>i)if(1==flowing){var u=round(random(-10,10)),d=round(random(-10,10));inCanvas(o[3]+u+a,o[4]+d)&&updateHashSpace(o[3]+u+a/2,o[4]+d,!0)}else inCanvas(o[3]+a/2,o[4])&&updateHashSpace(o[3]+a/2,o[4],!0)}}function scanSquareUD(a,e,r){var i=800;for(r&&(i=r),k=0;k<colorOfSquares.length-ceil(cWidth/a);k++){var o=colorOfSquares[k],n=colorOfSquares[k+ceil(cWidth/a)],c=o[0]-n[0],t=o[1]-n[1],s=o[2]-n[2];if(c*c+t*t+s*s>e||c*c>i||t*t>i||s*s>i)if(1==flowing){var u=round(random(-10,10)),d=round(random(-10,10));inCanvas(o[3]+u,o[4]+d+a/2)&&updateHashSpace(o[3]+u,o[4]+d+a/2,!0)}else inCanvas(o[3],o[4]+a/2)&&updateHashSpace(o[3],o[4]+a/2,!0)}}function generateRandomSquares(a,e){for(k=0;k<colorOfSquares.length;k++){var r=colorOfSquares[k];if(random(0,1)<=e)if(1==flowing){var i=round(random(-10,10)),o=round(random(-10,10));inCanvas(r[3]+i,r[4]+o)&&updateHashSpace(r[3]+i,r[4]+o,!0)}else inCanvas(r[3]+a/2,r[4])&&updateHashSpace(r[3]+a/2,r[4],!0)}}function autoGenPoints(a,e){pDensity=.1,e&&(pDensity=e),splitSquare(a),scanSquareLR(a,1e8),scanSquareUD(a,1e8),generateRandomSquares(a,pDensity)}